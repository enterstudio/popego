from popserver.model import *
from jq import producer

#Inicializo el dbmapping
import os
from paste.deploy import appconfig

dn = os.path.dirname
confDir = os.path.join(dn(dn(dn(os.path.abspath(__file__)))), 'popserver')
config = appconfig('config:development.ini', relative_to=confDir)
metadata.bind = config['sqlalchemy.url']

# TODO: puede pasar que halla un update ya encolado, y lo vuelva a poner en cola
# TODO: puede pasar que halla un update corriendo y no se da cuenta

for a in Account.query.all():
    producer.newJob("updateAccount", a.id)
