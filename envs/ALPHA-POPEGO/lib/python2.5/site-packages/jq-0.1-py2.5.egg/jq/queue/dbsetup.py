from sqlalchemy import create_engine, MetaData, Table, Column
from sqlalchemy import Integer, String, DateTime
from sqlalchemy.orm import mapper, sessionmaker

class DBSetup:
    __shared_state = {}
    def __init__(self):
        self.__dict__ = self.__shared_state

    def setup(self, dsn):
        self.engine = create_engine(dsn)
        self.metadata = MetaData()
        self.Session = sessionmaker(bind=self.engine, autoflush=True, transactional=True)
    
        self.jobs = Table('jobs', self.metadata,
                          Column('id', Integer, primary_key=True),
                          Column('type',String, nullable=False),
                          Column('data',String),
                          Column('creation_date',DateTime, nullable=False),
                          Column('started_date', DateTime),
                          Column('ended_date', DateTime),
                          Column('error',String))

